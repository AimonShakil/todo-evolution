# Implementation Plan: Phase I - Console Todo App

**Branch**: `002-phase-i-console-app` | **Date**: 2025-12-08 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/002-phase-i-console-app/spec.md`

**Note**: This file is generated by the `/sp.plan` command following the spec-driven workflow.

## Summary

Build a Python console application for multi-user task management with basic CRUD operations (add, view, update, delete, complete tasks). Users specify their username for data isolation. All tasks persist to a local SQLite database (`todo.db`) with a future-proof schema including nullable Phase V fields (description, priority, tags, due_date, recurrence_pattern). The application enforces constitutional principles: 80% test coverage, mypy --strict type checking, user data isolation via `WHERE user_id = ?` queries, and stateless architecture (database-backed state only).

**Technical Approach**: Python 3.13+ with SQLModel for database ORM, pytest for testing with coverage, mypy for strict type checking, black for formatting, and flake8 for linting. Console commands use argparse or Click for CLI parsing. SQLite database auto-creates on first run with complete schema.

## Technical Context

**Language/Version**: Python 3.13+ (constitutional requirement)
**Primary Dependencies**: SQLModel (SQLAlchemy-based ORM with Pydantic validation), sqlite3 (bundled), Click or argparse (CLI framework)
**Storage**: SQLite local database file (`todo.db` in current working directory)
**Testing**: pytest (with pytest-cov for coverage ≥80%)
**Target Platform**: Cross-platform (Linux, macOS, Windows) - any environment with Python 3.13+ and terminal
**Project Type**: Single project (console application) - determines source structure as `src/` and `tests/` at repository root
**Performance Goals**: Startup time <2 seconds with 1,000 tasks, all operations <500ms with 10,000 tasks
**Constraints**: Title length 1-200 characters, username non-empty, 100% human-readable error messages, exit codes (0 success, 1 error)
**Scale/Scope**: Up to 10,000 tasks per user in Phase I (database tested to this scale), multiple users sharing same `todo.db` file

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### Pre-Research Gate Evaluation

| Principle | Requirement | Phase I Status | Evidence/Plan |
|-----------|-------------|----------------|---------------|
| **I. Spec-Driven Development** | spec.md → plan.md → tasks.md workflow | ✅ PASS | Spec created (specs/002-phase-i-console-app/spec.md), plan in progress |
| **II. User Data Isolation** | `WHERE user_id = ?` on all queries | ✅ PASS | FR-010 mandates user_id filtering on all queries |
| **IV. Stateless Architecture** | No in-memory state, database-backed | ✅ PASS | FR-009 requires SQLite persistence, no session state |
| **IX. Code Quality Standards** | Type hints, docstrings, PEP 8, max function length 50 lines | ✅ PASS | SC-102 (mypy --strict), SC-103 (black), SC-104 (flake8) |
| **X. Testing Requirements** | ≥80% coverage, integration tests, user isolation tests | ✅ PASS | SC-101 (pytest --cov-fail-under=80), SC-105 (user isolation tests) |
| **XII. Security Principles** | Parameterized queries (SQL injection prevention) | ✅ PASS | FR-017 mandates parameterized queries |
| **XVI. Error Handling & Logging** | User-friendly errors, exit codes | ✅ PASS | FR-013 (human-readable errors), FR-019 (exit codes 0/1), SC-008 (100% human-readable) |
| **XXVII. Documentation Standards** | README, quickstart | ⏳ PENDING | Quickstart.md will be generated in Phase 1 |
| **XXVIII. Git & Version Control** | Feature branch, spec-driven commits | ✅ PASS | Branch 002-phase-i-console-app created, spec committed |

**Not Applicable to Phase I** (Console App):
- III. Authentication & Authorization (Phase II - Better Auth)
- V. MCP Tool Design (Phase III - AI chatbot)
- VI. Event-Driven Architecture (Phase V - Kafka)
- VII. Dapr Integration (Phase V - cloud)
- XI. Data Privacy & Retention (Phase V - GDPR export/deletion)
- XIII. Dependency Security (Phase II+ - npm audit, pip-audit in CI/CD)
- XIV. Authentication & Authorization (Phase II - Better Auth + JWT)
- XV. API Rate Limiting (Phase II - web API)
- XVII. Frontend Accessibility (Phase II - Next.js frontend)
- XVIII. Performance Standards (partial - basic performance targets in SC-009, SC-010)
- XIX. Monitoring & Observability (Phase V - Prometheus/Grafana)
- XX. Database Backup (Phase V - automated backups)
- XXI-XXVI. Event-Driven, Dapr, Containerization, Kubernetes, CI/CD, Conversation Persistence (Phase III-V)

**Gate Result**: ✅ **PASS** - All applicable constitutional principles satisfied by spec requirements

---

## Project Structure

### Documentation (this feature)

```text
specs/002-phase-i-console-app/
├── spec.md              # Feature specification (user stories, requirements, success criteria)
├── plan.md              # This file (/sp.plan command output)
├── research.md          # Phase 0 output (technology decisions, patterns, best practices)
├── data-model.md        # Phase 1 output (Task entity schema with future-proof fields)
├── quickstart.md        # Phase 1 output (setup, installation, usage guide)
├── contracts/           # Phase 1 output (CLI command interface definitions)
│   ├── add.md          # Command: add task
│   ├── view.md         # Command: view tasks
│   ├── update.md       # Command: update task title
│   ├── delete.md       # Command: delete task
│   ├── complete.md     # Command: mark task complete/incomplete
│   └── help.md         # Command: display help
└── checklists/
    └── requirements.md  # Spec quality validation (16/16 passed)
```

### Source Code (repository root)

```text
src/
├── models/
│   └── task.py          # Task entity (SQLModel) with future-proof schema
├── services/
│   ├── database.py      # Database connection, session management, auto-create schema
│   └── task_service.py  # CRUD operations with user isolation (WHERE user_id = ?)
├── cli/
│   ├── commands.py      # CLI command handlers (add, view, update, delete, complete, help)
│   └── main.py          # Entry point, CLI parser (Click/argparse), error handling
└── lib/
    └── validators.py    # Input validation (title 1-200 chars, username non-empty)

tests/
├── contract/
│   └── test_cli_commands.py  # Test CLI command interfaces match contracts/
├── integration/
│   ├── test_user_isolation.py  # Test user A cannot access user B's tasks (SC-105)
│   └── test_persistence.py     # Test data persists across app restarts
└── unit/
    ├── test_task_model.py      # Test Task entity validation rules
    ├── test_task_service.py    # Test CRUD operations, edge cases
    └── test_validators.py      # Test title/username validation logic

todo.db                  # SQLite database (auto-created on first run, gitignored)
pyproject.toml           # Project dependencies (SQLModel, pytest, mypy, black, flake8)
README.md                # Project overview, installation, quick start
.gitignore               # Ignore todo.db, __pycache__, .pytest_cache, .mypy_cache
```

**Structure Decision**: **Single project** structure selected because this is a standalone console application with no frontend/backend separation. All application code lives under `src/` with tests under `tests/` following standard Python project layout. This aligns with constitutional principle of simplicity (no unnecessary architectural complexity for Phase I console app).

---

## Complexity Tracking

> **No constitutional violations** - This section is empty because all applicable principles are satisfied.

All Phase I requirements align with constitutional principles:
- Spec-driven development (principle I) ✅
- User data isolation (principle II) ✅
- Stateless architecture (principle IV) ✅
- Code quality standards (principle IX) ✅
- Testing requirements (principle X) ✅
- Security (principle XII - parameterized queries) ✅

**Justification for Future-Proof Schema** (Principle I - Spec-Driven Development):
- Task model includes Phase V fields (description, priority, tags, due_date, recurrence_pattern) as nullable columns
- **Rationale**: Prevents schema migrations in Phase II-V (constitutional requirement to avoid manual database changes)
- **Tradeoff**: Slightly more complex initial schema vs **eliminates future breaking changes**
- **Decision**: Accept upfront complexity to maintain spec-driven workflow integrity across all phases

---

## Next Steps

1. **Phase 0: Research** - Generate `research.md` with technology decisions, patterns, best practices
2. **Phase 1: Design** - Generate `data-model.md`, `contracts/`, `quickstart.md`
3. **Phase 1: Agent Context Update** - Run `.specify/scripts/bash/update-agent-context.sh claude`
4. **Constitution Re-Check** - Validate Phase 1 design against all applicable principles
5. **Phase 2: Tasks** - Run `/sp.tasks` to generate dependency-ordered implementation tasks

**Post-Planning**: Ready for `/sp.tasks` command to decompose plan into executable tasks organized by user story
